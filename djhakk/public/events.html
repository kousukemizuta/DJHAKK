<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>イベント - DJHAKK</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        /* Page-specific styles */
        .search-box { position: relative; margin-bottom: 16px; }
        .search-input { width: 100%; padding: 14px 16px 14px 44px; background: var(--card); border: 1px solid var(--border); border-radius: var(--r-lg); color: var(--text); font-size: 16px; }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text3); }
        
        .filter-row { display: flex; gap: 8px; margin-bottom: 12px; align-items: center; }
        .filter-label { font-size: 12px; color: var(--text3); min-width: 40px; }
        .filters { display: flex; gap: 8px; flex-wrap: wrap; flex: 1; }
        .filter-btn { padding: 8px 16px; background: var(--card); border: 1px solid var(--border); border-radius: 20px; color: var(--text2); font-size: 13px; cursor: pointer; white-space: nowrap; }
        .filter-btn.active { background: var(--gradient); color: white; border-color: transparent; }
        
        /* Date Separator */
        .date-separator { display: flex; align-items: center; gap: 16px; margin: 28px 0 16px; }
        .date-separator:first-child { margin-top: 0; }
        .date-separator::before, .date-separator::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, transparent, var(--border), transparent); }
        .date-separator-inner { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--surface); border-radius: 20px; border: 1px solid var(--border); }
        .date-separator-date { font-family: 'Outfit', sans-serif; font-size: 18px; font-weight: 700; color: var(--primary); letter-spacing: 1px; }
        .date-separator-day { font-size: 12px; color: var(--text2); font-weight: 500; }
        
        /* Modal */
        .modal-img { width: 100%; aspect-ratio: 1; object-fit: cover; }
        .modal-title { font-size: 24px; font-weight: 700; margin-bottom: 16px; }
        .modal-info { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
        .modal-info-item { display: flex; align-items: center; gap: 8px; color: var(--text2); }
        
        /* Organizer Section */
        .organizer-section { background: var(--card); border-radius: var(--r-lg); padding: 16px; margin-bottom: 20px; }
        .organizer-header { font-size: 12px; color: var(--text3); margin-bottom: 12px; }
        .organizer-row { display: flex; align-items: center; gap: 12px; }
        .organizer-info { flex: 1; }
        .organizer-name { font-weight: 600; font-size: 15px; }
        .organizer-actions { display: flex; gap: 8px; }
        .organizer-btn { padding: 8px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; }
        .organizer-btn.profile { background: var(--surface); color: var(--text2); }
        .organizer-btn.dm { background: var(--gradient); color: white; }
        
        /* Slot Card */
        .section-title { font-size: 14px; font-weight: 600; color: var(--text3); margin: 20px 0 12px; }
        .slot-card { background: var(--card); border-radius: var(--r-lg); padding: 16px; margin-bottom: 12px; }
        .slot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .slot-time { font-weight: 600; font-size: 15px; }
        .slot-price { font-size: 18px; font-weight: 700; color: var(--primary); }
        .slot-price.free { color: #00D9FF; }
        .slot-applicants { margin-bottom: 12px; }
        .slot-applicants-label { font-size: 12px; color: var(--text3); margin-bottom: 8px; }
        .slot-applicants-row { display: flex; align-items: center; gap: 4px; flex-wrap: wrap; }
        .slot-count { font-size: 13px; color: var(--text2); margin-left: 8px; }
        .slot-count.full { color: #FF4757; font-weight: 600; }
        .slot-buy-btn { width: 100%; padding: 12px; border-radius: var(--r-md); font-weight: 600; font-size: 14px; cursor: pointer; border: none; }
        .slot-buy-btn.primary { background: var(--gradient); color: white; }
        .slot-buy-btn.free { background: #00D9FF; color: #0D0D1A; }
        .slot-buy-btn.full { background: var(--border); color: var(--text3); cursor: not-allowed; }
        .slot-buy-btn.applied { background: rgba(0,217,255,0.2); color: #00D9FF; cursor: not-allowed; }
        .slot-buy-btn.approved { background: rgba(46,204,113,0.2); color: #2ECC71; cursor: not-allowed; }
        .slot-buy-btn.completed { background: rgba(46,204,113,0.3); color: #2ECC71; cursor: not-allowed; }
        
        /* Purchase Modal */
        .purchase-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 300; align-items: center; justify-content: center; padding: 20px; }
        .purchase-modal.active { display: flex; }
        .purchase-box { background: var(--surface); border-radius: 20px; padding: 28px; max-width: 340px; width: 100%; text-align: center; }
        .purchase-icon { font-size: 56px; margin-bottom: 16px; }
        .purchase-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; }
        .purchase-detail { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .purchase-time { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .purchase-price { font-size: 32px; font-weight: 700; color: var(--primary); }
        .purchase-price.free { color: #00D9FF; }
        .purchase-note { color: var(--text2); font-size: 13px; margin-bottom: 20px; }
        .purchase-btn { width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; font-size: 16px; cursor: pointer; border: none; margin-bottom: 10px; }
        .purchase-btn.primary { background: var(--gradient); color: white; }
        .purchase-btn.free { background: #00D9FF; color: #0D0D1A; }
        .purchase-btn.cancel { background: var(--card); color: var(--text2); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" class="header-logo" onclick="window.location.href='timeline.html'">
            <span class="header-title">EVENT</span>
            <div id="headerProfileArea"></div>
        </div>
        <div class="search-box">
            <span class="search-icon"><svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg></span>
            <input type="text" class="search-input" placeholder="EVENT SEARCH" id="searchInput" oninput="filterEvents()">
        </div>
        
        <div class="filter-row">
            <span class="filter-label">Type</span>
            <div class="filters">
                <button class="filter-btn active" data-filter="all" onclick="setTypeFilter('all')">All</button>
                <button class="filter-btn" data-filter="A" onclick="setTypeFilter('A')">TIMETABLE</button>
                <button class="filter-btn" data-filter="B" onclick="setTypeFilter('B')">GUARANTEE(ｷﾞｬﾗ)</button>
                <button class="filter-btn" data-filter="C" onclick="setTypeFilter('C')">FLYER</button>
            </div>
        </div>
        
        <div class="filter-row">
            <span class="filter-label">AREA</span>
            <select id="regionFilter" class="region-select" onchange="setRegionFilter()">
                <option value="all">ALL AREA</option>
                <optgroup label="JAPAN">
                    <option value="TOKYO">TOKYO</option>
                    <option value="OSAKA">OSAKA</option>
                    <option value="NAGOYA">NAGOYA</option>
                    <option value="FUKUOKA">FUKUOKA</option>
                    <option value="OKINAWA">OKINAWA</option>
                </optgroup>
                <optgroup label="ASIA">
                    <option value="SEOUL">SEOUL</option>
                    <option value="SHANGHAI">SHANGHAI</option>
                    <option value="HONG KONG">HONG KONG</option>
                    <option value="BANGKOK">BANGKOK</option>
                    <option value="SINGAPORE">SINGAPORE</option>
                </optgroup>
                <optgroup label="NORTH AMERICA">
                    <option value="NEW YORK">NEW YORK</option>
                    <option value="LOS ANGELES">LOS ANGELES</option>
                    <option value="MIAMI">MIAMI</option>
                    <option value="CHICAGO">CHICAGO</option>
                    <option value="LAS VEGAS">LAS VEGAS</option>
                </optgroup>
                <optgroup label="EUROPE">
                    <option value="BERLIN">BERLIN</option>
                    <option value="LONDON">LONDON</option>
                    <option value="AMSTERDAM">AMSTERDAM</option>
                    <option value="IBIZA">IBIZA</option>
                    <option value="PARIS">PARIS</option>
                    <option value="BARCELONA">BARCELONA</option>
                </optgroup>
            </select>
        </div>
        
        <div id="eventsList"></div>
        
        <!-- Pagination UI -->
        <div id="loadingSpinner" class="loading-spinner" style="display:none;">
            <img src="logo.png" class="spinner-logo">
            <span>Loading...</span>
        </div>
        <button id="loadMoreBtn" class="load-more-btn" style="display:none;" onclick="loadMoreEvents()">もっと見る</button>
        <div id="noMoreData" class="no-more-data" style="display:none;"><img src="logo.png"></div>
    </div>
    
    <!-- Event Detail Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeEventModal()">← Back</button>
            </div>
            <img id="modalImg" class="modal-img" src="logo.png">
            <div class="modal-body">
                <span class="badge a" id="modalBadge">TIMETABLE</span>
                <h1 class="modal-title" id="modalTitle"></h1>
                <div class="modal-info">
                    <div class="modal-info-item" id="modalDate">DATE </div>
                    <div class="modal-info-item" id="modalLocation">@ </div>
                    <div class="modal-info-item" id="modalRegion">AREA </div>
                </div>
                
                <div id="modalOrganizer" class="organizer-section"></div>
                <div id="modalSlots"></div>
                <div id="modalAction"></div>
                <p id="modalDesc" style="color: var(--text2); margin-top: 20px; white-space: pre-wrap; word-break: break-word;"></p>
            </div>
        </div>
    </div>
    
    <!-- Purchase Confirmation Modal -->
    <div class="purchase-modal" id="purchaseModal">
        <div class="purchase-box">
            <div class="purchase-icon" id="purchaseIcon"></div>
            <div class="purchase-title" id="purchaseTitle">Buy Timetable</div>
            <div class="purchase-detail">
                <div class="purchase-time" id="purchaseTime">22:00-22:30</div>
                <div class="purchase-price" id="purchasePrice">¥3,000</div>
            </div>
            <p class="purchase-note" id="purchaseNote">Buy this slot to perform at the event?</p>
            <button class="purchase-btn primary" id="purchaseConfirmBtn" onclick="confirmPurchase()">Confirm Purchase</button>
            <button class="purchase-btn cancel" onclick="closePurchaseModal()">Cancel</button>
        </div>
    </div>
    
    <!-- Floating Action Button -->
    <button class="fab" onclick="handleCreateClick()">+</button>
    
    <!-- Footer Navigation -->
    <nav class="nav">
        <div class="nav-item" onclick="window.location.href='index.html?tab=home'"><span>Home</span></div>
        <div class="nav-item active"><span>Event</span></div>
        <div class="nav-item" onclick="window.location.href='timeline.html'"><span>TimeLine</span></div>
        <div class="nav-item" onclick="window.location.href='productions.html'"><span>Production</span></div>
        <div class="nav-item" onclick="window.location.href='place.html'"><span>Place</span></div>
    </nav>
    <div class="toast" id="toast"></div>
    
    <!-- Common JS -->
    <script src="js/config.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/data.js"></script>
    <script src="js/interactions.js"></script>
    <script src="js/audio-player.js"></script>
    <script src="js/stripe.js"></script>
    
    <!-- Page-specific JS -->
    <script src="js/pages/events.js"></script>
    <script src="js/lazy-load.js"></script>
</body>
</html>
